<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Create Ticket</title>
    <link th:rel="stylesheet" th:href="@{/webjars/bootstrap/5.1.3/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/css/application.css}">
    <style>
        .form-control, .form-select, textarea {
            background: rgba(2,6,10,0.45);
            color: #000 !important;
            border: 1px solid rgba(72,245,182,0.08);
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .form-control::placeholder, .form-select::placeholder, textarea::placeholder {
            color: rgba(0,0,0,0.4);
        }
        .form-control:focus, .form-select:focus, textarea:focus {
            box-shadow: 0 0 10px rgba(100,150,255,0.5);
            border-color: rgba(100,150,255,0.7);
            color: #000 !important;
        }
    </style>
</head>
<body>
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header">
                    <h3>Create New Ticket</h3>
                </div>
                <div class="card-body">
                    <!-- Mostra errori globali -->
                    <div th:if="${#fields.hasErrors()}" class="alert alert-danger">
                        <ul>
                            <li th:each="err : ${#fields.errors('*')}" th:text="${err}"></li>
                        </ul>
                    </div>

                    <form th:action="@{/tickets/create}" method="post" th:object="${ticket}">
                        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

                        <div class="mb-3">
                            <label for="titolo" class="form-label">Title</label>
                            <input type="text" th:field="*{titolo}" class="form-control" id="titolo" placeholder="Enter ticket title" required>
                            <div class="text-danger small" th:if="${#fields.hasErrors('titolo')}" th:errors="*{titolo}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="description" class="form-label">Description</label>
                            <textarea th:field="*{description}" class="form-control" id="description" rows="4" placeholder="Describe the problem" required></textarea>
                            <div class="text-danger small" th:if="${#fields.hasErrors('description')}" th:errors="*{description}"></div>
                        </div>

                        <div class="mb-3">
                            <label for="category" class="form-label">Category</label>
                            <select th:field="*{category}" class="form-select" id="category" required>
                                <option value="" disabled selected>Select category</option>
                                <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat.name}"></option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="status" class="form-label">Status</label>
                            <select th:field="*{status}" class="form-select" id="status" required>
                                <option value="" disabled selected>Select status</option>
                                <option th:each="status : ${statusNamesList}" th:value="${status}" th:text="${status}"></option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label for="user" class="form-label">Assign Operator</label>
                            <select th:field="*{user}" class="form-select" id="user" required>
                                <option value="" disabled selected>Select operator</option>
                                <option th:each="op : ${operators}" th:value="${op}" th:text="${op.username}"></option>
                            </select>
                        </div>

                        <button type="submit" class="btn btn-primary w-100">Create Ticket</button>
                        <a th:href="@{/tickets}" class="btn btn-outline-info w-100 mt-2">Back to Tickets</a>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.bundle.min.js}"></script>
</body>
</html>